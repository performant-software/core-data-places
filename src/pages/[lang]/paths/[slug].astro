---
import PathViewer from "@apps/paths/PathViewer";
import { fetchPath, fetchPaths } from "@backend/tina";
import config from "@config";
import { getTranslations } from "@backend/i18n";
import Layout from "@layouts/Layout.astro";
import { hasPathsContent } from "@utils/config";
import _ from "underscore";

const { slug } = Astro.params;
const locale = Astro.currentLocale;
const path = await fetchPath(locale, slug);

const { t } = await getTranslations(locale);
const title = path?.title || t("paths");

export const getStaticPaths = async () => {
  if (!hasPathsContent(config)) {
    return [];
  }

  const staticPaths = [];

  for (const lang of config.i18n.locales) {
    const paths = await fetchPaths(lang);

    for (const path of paths) {
      paths.push({ params: { lang, slug: path._sys.filename } });
    }
  }

  return paths;
};
---

<Layout fullscreen t={t} tab="paths" title={title}>
  {path && <PathViewer path={path} client:only="react" />}
</Layout>
