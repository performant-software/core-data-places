---
import Post from '@components/Post.astro';
import { getTranslations } from '@backend/i18n';
import { fetchPosts } from '@backend/tina';
import Container from '@components/Container.astro';
import config from '@config';
import Layout from '@layouts/Layout.astro';
import { hasPostsContent } from '@utils/config';
import _ from 'underscore';

const { slug } = Astro.params;

const { t } = await getTranslations(Astro.currentLocale);

export const getStaticPaths = async () => {
  if (!hasPostsContent(config)) {
    return [];
  }

  const staticPaths = [];

  const locales = config.i18n.locales;
  const posts = await fetchPosts();

  _.each(locales, (lang) => {
    _.each(posts, (post) => {
      staticPaths.push({ params: {
        lang,
        slug: post?._sys.filename
      }});
    });
  });

  return staticPaths;
};
---

<Layout
  footer
  t={t}
  tab='posts'
  title={slug}
>
  <Container
    className='pb-16 w-full'
  >
    <Post
      slug={slug}
      server:defer
    />
  </Container>
</Layout>
