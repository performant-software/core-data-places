---
import PostContent from '@apps/posts/PostContent';
import { getTranslations } from '@backend/i18n';
import { fetchPost, fetchPosts } from '@backend/tina';
import Container from '@components/Container.astro';
import config from '@config';
import Layout from '@layouts/Layout.astro';
import { hasPostsContent } from '@utils/config';
import _ from 'underscore';

const { slug } = Astro.params;

const locale = Astro.currentLocale;

const post = await fetchPost(locale, slug);
const { t } = await getTranslations(locale);

export const getStaticPaths = async () => {
  if (!hasPostsContent(config)) {
    return [];
  }

  const paths = [];

  for (const lang of config.i18n.locales) {
    const posts = await fetchPosts(lang);

    for (const post of posts) {
      paths.push({ params: { lang, slug: post._sys.filename } });
    }
  }

  return paths;
};
---

<Layout footer t={t} tab='posts' title={post?.title}>
  <Container className='pb-16 w-full'>
    <PostContent
      content={post?.body}
      title={post?.title}
      author={post?.author}
      date={post?.date}
      client:only='react'
    />
  </Container>
</Layout>
