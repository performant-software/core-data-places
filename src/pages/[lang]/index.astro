---
import { fetchAbout } from '@backend/tina-server';
import Container from '@components/Container.astro';
import Hero from '@components/Hero.astro';
import config from '@config';
import { getTranslations } from '@i18n/server';
import Layout from '@layouts/Layout.astro';
import { TinaMarkdown } from 'tinacms/dist/rich-text';
import _ from 'underscore';

const aboutResponse = await fetchAbout();
const { heroImage, featureImage } = aboutResponse;

// Get localized content, defaulting to the default language if not defined
const { title } = Astro.currentLocale == config.i18n.default_locale || !aboutResponse[Astro.currentLocale]?.title ? aboutResponse : aboutResponse[Astro.currentLocale];
const { subheader } = Astro.currentLocale == config.i18n.default_locale || !aboutResponse[Astro.currentLocale]?.subheader ? aboutResponse : aboutResponse[Astro.currentLocale];
const { description } = Astro.currentLocale == config.i18n.default_locale || !aboutResponse[Astro.currentLocale]?.description ? aboutResponse : aboutResponse[Astro.currentLocale];

const { t } = await getTranslations(Astro.currentLocale);

export const getStaticPaths = () => _.map(config.i18n.locales, (lang) => ({ params: { lang }}));

---

<Layout
  footer
  t={t}
  title={title}
>
  <Hero 
    title={title}
    subheader={subheader}
    image={heroImage}
  />
  <Container
    className="my-12 grid lg:grid-cols-2 gap-16"
  >
    <div>
      <h2
        class="text-5xl font-serif "
      >
        { t('about') }
      </h2>
      <article
        class="py-8 prose prose-lg max-w-none"
      >
        <TinaMarkdown
          content={description}
        />
      </article>
    </div>
    <img
      alt=""
      src={featureImage}
      class="w-full"
    />
  </Container>
</Layout>
