---
import MapSearch from '@apps/search/map/MapSearch';
import { getTranslations } from '@backend/i18n';
import config from '@config';
import Layout from "@layouts/Layout.astro";
import { STATIC_BUILD } from 'astro:env/client';
import _ from 'underscore';
import ListSearch from "@apps/search/list/ListSearch";
import { SearchConfig } from "@types";

const { lang } = Astro.params

const { t } = await getTranslations(Astro.currentLocale);
const { name } = Astro.params;

export const getStaticPaths = () => {
  const paths = [];

  _.each(config.i18n.locales, (lang) => {
    _.each(config.search, ({name}) => {
      paths.push({params: {lang, name}});
    });
  });

  return paths;
};

const searchConfig = config.search.find((s) => s.name === name) as SearchConfig;

const isListSearch = searchConfig.type === 'list' || searchConfig.type === 'grid';
---

<Layout
  fullscreen
  t={t}
  title={t('explore')}
  tab="search"
>
  {isListSearch
    ? (
      <ListSearch
        lang={lang}
        name={name}
        client:only='react'
      />
    )
    : (
      <MapSearch
        allowSave={!STATIC_BUILD}
        lang={lang}
        name={name}
        client:only='react'
      />
    )
  }
</Layout>
