---
import { Models } from '@types';
import ServiceFactory from '@services/coreData/factory';
import Relations from '@apps/pages/RecordDetail/Relations.astro';
import { getNameView } from '@utils/people';
import { groupRelationships } from '@utils/detailPages';

interface Props {
  excludes: string[];
  model: string;
  uuid: string;
}

const { excludes, model, uuid } = Astro.props;

const service = ServiceFactory.getService(model);
const { people } = await service.getRelatedPeople(uuid);
const relationships = groupRelationships(people, excludes);
---
{Object.keys(relationships).map((uuid) => (
  <Relations
    data={relationships[uuid]}
    icon='person'
    model='people'
    resolveName={person => getNameView(person)}
    uuid={uuid}
  />
))}